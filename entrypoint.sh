#!/usr/bin/env bash

#=========================================================================================
# Variables
#=========================================================================================
CERT_DIR="/etc/letsencrypt/live/${DOMAIN}"

#=========================================================================================
# Functions
#=========================================================================================

log() {
    echo -e "$(date "+%b %d %T")" "$(basename "$0")" - "$@" 
}

watch_certs() {
  while inotifywait --quiet --event close_write --format %w%f ${CERT_DIR}
  do
    echo -e "------------------------------------------------------------------------------------------------------"
    log "Detected a change in [${CERT_DIR}]"
    log "Reloading NGINX"
    /sbin/nginx -s reload
  done
}

##########################################################################################

# Watch for Cert changes
watch_certs & 

# Start NGINX
nginx -g "daemon off;"